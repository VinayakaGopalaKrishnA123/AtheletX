<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kridaverse</title>
  <link rel="stylesheet" href="login.css">
</head>
<body>
  <div class="login-register-slider">
    <div class="slider-glass"></div>
    <div class="login-slide">Login</div>
    <div class="register-slide">Register</div>
  </div>

  <div class="title">KRIDAVERSE</div>

  <div class="login-box">
    <h2 class="logregheading">Login</h2>
    <input type="text" placeholder="Username" class="username"/>
    <input type="password" placeholder="Password" class="password"/>
    <button class="logregbut">Login</button>
  </div>

  <script>
    const slider = document.querySelector('.login-register-slider');
    const glass = document.querySelector('.slider-glass');
    const login = document.querySelector('.login-slide');
    const register = document.querySelector('.register-slide');
    const lrbut = document.querySelector('.logregbut');
    const heading = document.querySelector('.logregheading');
    const usernameInput = document.querySelector('.username');
    const passwordInput = document.querySelector('.password');

    let mode = 0;

    function moveGlass(target) {
      const targetRect = target.getBoundingClientRect();
      const sliderRect = slider.getBoundingClientRect();

      glass.style.width = `${targetRect.width}px`;
      glass.style.height = `${targetRect.height}px`;
      glass.style.left = `${targetRect.left - sliderRect.left}px`;
      glass.style.top = `${targetRect.top - sliderRect.top}px`;

      lrbut.innerText = target.innerText;
      heading.innerText = target.innerText;
      mode = target.innerText === 'Login' ? 0 : 1;

      // Clear input fields
      usernameInput.value = '';
      passwordInput.value = '';
    }

    login.onclick = () => moveGlass(login);
    register.onclick = () => moveGlass(register);

    window.onload = () => {
      moveGlass(login);
      mode = 0;

      // Optional: preload initial users
      if (!localStorage.getItem("users")) {
        const usersDB = {
          users: [
            { username: "varun123", password: "pass123" },
            { username: "john_doe", password: "helloWorld" },
            { username: "krida", password: "verse2025" }
          ]
        };
        localStorage.setItem("users", JSON.stringify(usersDB.users));
      }
    };

    function lrfun() {
      const un = usernameInput.value.trim();
      const pwd = passwordInput.value.trim();

      if (!un || !pwd) {
        alert('Please fill in both fields.');
        return;
      }

      let users = JSON.parse(localStorage.getItem("users")) || [];

      if (mode === 0) {
        // Login
        const matchedUser = users.find(user => user.username === un && user.password === pwd);

        if (matchedUser) {
          alert("Login successful!");
          window.location.href = "../home/index.html";
        } else {
          alert("Invalid username or password.");
        }
      } else {
        // Register
        const userExists = users.some(user => user.username === un);

        if (userExists) {
          alert("Username already exists.");
        } else {
          users.push({ username: un, password: pwd });
          localStorage.setItem("users", JSON.stringify(users));
          alert("Registration successful!");
        }
      }
    }

    lrbut.onclick = () => lrfun();
  </script>
</body>
</html>